var D=Object.defineProperty;var q=(r,e,t)=>e in r?D(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var g=(r,e,t)=>q(r,typeof e!="symbol"?e+"":e,t);import{j as i}from"./jsx-runtime-z8MfsBtr.js";import{r as d}from"./index-BofL8h0e.js";import{C as v}from"./Card-BNZe5Qsc.js";import{B as N}from"./Button-VBjU_o9A.js";const T=({id:r,title:e,children:t,onRemove:a,className:s})=>i.jsxs(v,{title:e,className:`storybook-widget ${s||""}`,children:[i.jsx("div",{className:"storybook-widget-content",children:t}),a&&i.jsx("div",{className:"storybook-widget-button-container",children:i.jsx(N,{size:"small",label:"Remove",onClick:()=>a(r)})})]});T.__docgenInfo={description:"",methods:[],displayName:"Widget",props:{id:{required:!0,tsType:{name:"string"},description:""},title:{required:!0,tsType:{name:"string"},description:""},onRemove:{required:!1,tsType:{name:"signature",type:"function",raw:"(id: string) => void",signature:{arguments:[{type:{name:"string"},name:"id"}],return:{name:"void"}}},description:""},className:{required:!1,tsType:{name:"string"},description:""},children:{required:!0,tsType:{name:"ReactReactNode",raw:"React.ReactNode"},description:""}}};const R=({dataProvider:r,...e})=>i.jsx(T,{...e,children:e.children});R.__docgenInfo={description:"",methods:[],displayName:"DataDrivenWidget",props:{id:{required:!0,tsType:{name:"string"},description:""},title:{required:!0,tsType:{name:"string"},description:""},onRemove:{required:!1,tsType:{name:"signature",type:"function",raw:"(id: string) => void",signature:{arguments:[{type:{name:"string"},name:"id"}],return:{name:"void"}}},description:""},className:{required:!1,tsType:{name:"string"},description:""},dataProvider:{required:!0,tsType:{name:"DataProvider"},description:""}}};const c=class c{static set(e,t,a=c.DEFAULT_TTL){this.cache.set(e,{data:t,timestamp:Date.now()+a})}static get(e){const t=this.cache.get(e);return t?Date.now()>t.timestamp?(this.cache.delete(e),null):t.data:null}static clear(){this.cache.clear()}};g(c,"cache",new Map),g(c,"DEFAULT_TTL",5*60*1e3);let m=c;const j=({remoteDataProvider:r,renderData:e,adaptTitle:t,cacheKey:a,cacheTTL:s,...o})=>{const[u,p]=d.useState(null),[w,l]=d.useState(!0),[y,f]=d.useState(null),h=d.useMemo(()=>async()=>{if(a){const n=m.get(a);if(n){p(n),l(!1);return}}try{l(!0);const n=await r.fetch();a&&m.set(a,n,s),p(n),f(null)}catch(n){f(n instanceof Error?n:new Error("An error occurred"))}finally{l(!1)}},[r,a,s]);return d.useEffect(()=>{h()},[h]),i.jsx(R,{...o,dataProvider:r,title:t?t(u):o.title,children:w?i.jsx("div",{children:"Loading..."}):y?i.jsxs("div",{style:{color:"red"},children:["Error: ",y.message]}):e(u)})};j.__docgenInfo={description:"",methods:[],displayName:"RemoteDataWidget",props:{remoteDataProvider:{required:!0,tsType:{name:"RemoteDataProvider"},description:""},renderData:{required:!0,tsType:{name:"signature",type:"function",raw:"(data: any) => React.ReactNode",signature:{arguments:[{type:{name:"any"},name:"data"}],return:{name:"ReactReactNode",raw:"React.ReactNode"}}},description:""},adaptTitle:{required:!1,tsType:{name:"signature",type:"function",raw:"(data: any) => string",signature:{arguments:[{type:{name:"any"},name:"data"}],return:{name:"string"}}},description:""},cacheKey:{required:!1,tsType:{name:"string"},description:""},cacheTTL:{required:!1,tsType:{name:"number"},description:""}},composes:["Omit"]};class P{constructor(e){this.props=e}async fetch(){const{endpoint:e,config:t,type:a}=this.props,s=e.startsWith("http")?new URL(e):new URL(e,window.location.origin);if(t!=null&&t.params&&Object.entries(t.params).forEach(([u,p])=>{s.searchParams.append(u,p)}),a==="image")return s.toString();const o=await fetch(s.toString(),{headers:t==null?void 0:t.headers});if(!o.ok)throw new Error(`HTTP error! status: ${o.status}`);return o.json()}}export{R as D,j as R,T as W,P as a};
